@page
@model Event.RazorWebApp.Pages.Category.PaymentPageModel
@{
    ViewData["Title"] = "PaymentPage";
    var payment = Model.payment;
    var payments = Model.Payments;
}
<div class="text-center">
    <h1 class="display-6">Payment Management</h1>
</div>

<div class="row mb-3">
    <button id="createNewButton" class="btn btn-primary" onclick="popEdit(document.getElementById('bookingModal'))">Create</button>
</div>

<div class="row">
    <div class="col-md-12">
        <table class="table table-striped table-bordered table-hover">
            <thead>
                <tr class="card-header">
                    <th class="card-title table-center">Id</th>
                    <th class="card-title table-center">RegisterId</th>
                    <th class="card-title table-center">TicketId</th>
                    <th class="card-title table-center">TicketQuantity</th>
                    <th class="card-title table-center">PaymentDate</th>
                    <th class="card-title table-center">AmountPaid</th>
                    <th class="card-title table-center">Status</th>
                    <th class="card-title table-center">PaymentType</th>
                    <th class="card-title table-center">Actions</th>
                </tr>
            </thead>
            <tbody class="tblcustomerList">
                @foreach (var item in payments)
                {
                    <tr>
                        <td>@item.PaymentId</td>
                        <td>@item.RegistrationId</td>
                        <td>@item.TicketId</td>
                        <td>@item.TicketQuantity</td>
                        <td>@item.PaymentDate</td>
                        <td>@item.AmountPaid</td>
                        <td>@item.Status</td>
                        <td>@item.PaymentType</td>
                        <td>
                            <button class="btn btn-primary updateBtn" onclick="updatePayment('@item.PaymentId', '@item.RegistrationId', '@item.TicketId', '@item.TicketQuantity', '@item.AmountPaid.Value', '@item.Status.Value', '@item.PaymentType')">
                                Update
                            </button>
                            <form method="post" asp-page-handler="Delete" style="display:inline;">
                                <input type="hidden" name="id" value="@item.PaymentId" />
                                <button type="submit" class="btn btn-danger" onclick="confirmDelete(event)">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

<div id="bookingModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal(this)">&times;</span>
        <h2>New Payment</h2>
        <form method="post" asp-page-handler="Create">
            <div class="form-group">
                <label for="PaymentId">Payment Id:</label>
                <input type="text" id="PaymentId" name="PaymentId" class="form-control" asp-for="payment.PaymentId" required>

                <label for="RegistrationId">Registration Id:</label>
                <input type="text" id="RegistrationId" name="RegistrationId" class="form-control" asp-for="payment.RegistrationId" required>

                <label for="TicketId">Ticket Id:</label>
                <input type="text" id="TicketId" name="TicketId" class="form-control" asp-for="payment.TicketId" required>

                <label for="TicketQuantity">Ticket Quantity:</label>
                <input type="text" id="TicketQuantity" name="TicketQuantity" class="form-control" asp-for="payment.TicketQuantity" required>

                <label for="AmountPaid">Amount Paid:</label>
                <input type="text" id="AmountPaid" name="AmountPaid" class="form-control" asp-for="payment.AmountPaid" required>

                <label for="Status">Status:</label>
                <input type="text" id="Status" name="Status" class="form-control" asp-for="payment.Status" required>

                <label for="PaymentType">Payment Type:</label>
                <input type="text" id="PaymentType" name="PaymentType" class="form-control" asp-for="payment.PaymentType" required>
            </div>
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
</div>

<div id="updatingModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal(this)">&times;</span>
        <h2>Update Payment</h2>
        <form method="post" asp-page-handler="Update">
            <div class="form-group">
                <label for="PaymentId">Payment Id:</label>
                <input type="text" id="UpdatePaymentId" name="PaymentId" class="form-control" asp-for="payment.PaymentId" required>

                <label for="RegistrationId">Registration Id:</label>
                <input type="text" id="UpdateRegistrationId" name="RegistrationId" class="form-control" asp-for="payment.RegistrationId" required>

                <label for="TicketId">Ticket Id:</label>
                <input type="text" id="UpdateTicketId" name="TicketId" class="form-control" asp-for="payment.TicketId" required>

                <label for="TicketQuantity">Ticket Quantity:</label>
                <input type="text" id="UpdateTicketQuantity" name="TicketQuantity" class="form-control" asp-for="payment.TicketQuantity" required>

                <label for="AmountPaid">Amount Paid:</label>
                <input type="text" id="UpdateAmountPaid" name="AmountPaid" class="form-control" asp-for="payment.AmountPaid" required>

                <label for="Status">Status:</label>
                <input type="text" id="UpdateStatus" name="Status" class="form-control" asp-for="payment.Status" required>

                <label for="PaymentType">Payment Type:</label>
                <input type="text" id="UpdatePaymentType" name="PaymentType" class="form-control" asp-for="payment.PaymentType" required>
            </div>
            <button type="submit" class="btn btn-success">Submit</button>
        </form>
    </div>
</div>

@section Scripts {
    <script>
        function popEdit(element) {
            element.style.display = "block";
        }

        function closeModal(element) {
            element.closest('.modal').style.display = "none";
        }

        window.onclick = function (event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = "none";
            }
        }

        function confirmDelete(event) {
            event.preventDefault();
            if (confirm("Are you sure you want to delete this payment?")) {
                event.target.closest("form").submit();
            }
        }

        function updatePayment(paymentId, registrationId, ticketId, ticketQuantity, amountPaid, status, paymentType) {

            document.getElementById('updatingModal').style.display = "block";
            document.getElementById('UpdatePaymentId').value = paymentId;
            document.getElementById('UpdateRegistrationId').value = registrationId;
            document.getElementById('UpdateTicketId').value = ticketId;
            document.getElementById('UpdateTicketQuantity').value = ticketQuantity;
            document.getElementById('UpdateAmountPaid').value = amountPaid;
            document.getElementById('UpdateStatus').value = status;
            document.getElementById('UpdatePaymentType').value = paymentType;

        }
    </script>
}

<style>
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(5px);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 10% auto;
        padding: 20px;
        border-radius: 10px;
        border: 1px solid #888;
        width: 50%;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    .form-group {
        margin-bottom: 15px;
    }

        .form-group label {
            font-weight: bold;
        }

    .form-control {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        border: 1px solid #ccc;
        border-radius: 5px;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-success {
        background-color: #28a745;
        color: white;
    }

    .btn-danger {
        background-color: #dc3545;
        color: white;
    }

    .btn:hover {
        opacity: 0.8;
    }
</style>
